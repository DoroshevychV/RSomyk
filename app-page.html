<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Books Application R. Somyk</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--ajax-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>
<body>
<!--Navigation-->
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="login.html">BookApp</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav pull-right">
                <li>
                    <h3 id="username" style="color: white;display: none"></h3>
                    <button type="button" class="login-btn" data-toggle="modal" data-target="#LoginModal"> Log In
                    </button>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>
<!--End of navigation part-->


<!--Page container-->
<div class="container">

    <!--Book table field -->
    <table class="table table-bordered">
        <thead>
        <tr>
            <th scope="col">№</th>
            <th scope="col">Book Name</th>
            <th scope="col">Genre</th>
            <th scope="col">Authors</th>
        </tr>
        </thead>
        <tbody id="books-table">
        <!--<tr>-->
            <!--<th scope="row">1</th>-->
            <!--<td>Веселі вихідні</td>-->
            <!--<td>Genre here</td>-->
            <!--<td>Ivan Pelykh</td>-->

        <!--</tr>-->

        </tbody>
    </table>
    <!--End ofBook table -->


    <!--Button's field start here-->
    <div class="well">

        <!--Unlog button group-->
        <div class="btn-group">
            <!--Author name dropdown list-->
            <div class="btn-field">
                <h5>Author</h5>
                <select class="form-control" id="authors-select-list">

                </select>
                <!--<h5>Author name</h5>-->
                <!--<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"-->
                        <!--aria-haspopup="true" aria-expanded="false">-->
                    <!--Author name <span class="caret"></span>-->
                <!--</button>-->
                <!--<ul class="dropdown-menu list-group" id="authors-select-list">-->

                <!--</ul>-->
            </div>
            <!--End of Author name dropdownlist-->

            <!--Quantity field-->
            <div class="btn-field">
                <h5>Book Qty</h5>
                <button type="button" onclick="" class="btn btn-default qty-btn">
                    Quantity
                </button>
            </div>


            <div class="btn-field">
                <h5>Qty result</h5>
                <span class="badge"></span>
            </div>
            <!--End of quantity field-->
        </div>
        <!--End of Unlog button group-->


        <!--Login button group-->
        <div class="btn-group pull-right" id="edit-book" role="group" aria-label="...">
            <h5>Add book</h5>
            <button onclick="add_book()" type="button" class="btn btn-primary">Edit books</button>
        </div>
        <!--End of login button group-->

        <!--Edit Book table field -->

        <!--Add book-->
        <div id="add_book">
            <h3>This block is for editing books in the table </h3>
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th scope="col">Book Name</th>
                    <th scope="col">Genre</th>
                    <th scope="col">Authors</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td scope="row"><input type="text" name="book-name" id="add-book-name" placeholder="Book name"></td>
                    <td><input type="text" name="Genre book" id="add-book-genre" placeholder="Book Genre"></td>
                    <td>
                        <form autocomplete="off">
                            <div class="autocomplete" style="width:300px;">
                                <input id="myInput" type="text" id="add-book-author-name" name="authorName" placeholder="Author">
                            </div>
                        </form>
                    </td>
                </tr>
                </tbody>

                <!--Save added books form-->
                <div class="btn-group pull-right save-book-btn" role="group" aria-label="...">
                    <form>
                        <button type="button" id="add-book-save-button" class="btn btn-success">Save book</button>
                    </form>
                </div>
                <!--End of Save added books form-->
            </table>

            <!--Delete book-->
            <div class="delete-book-group">
                <h5>Enter book ID to delete it</h5>
                <div class="btn-group " role="group" aria-label="...">
                    <input type="text" name="book-id" class="delete-item">
                    <button type="button" class="btn btn-warning delete-item">DELETE BOOK</button>
                </div>
            </div>
            <!--End of delete book-->


        </div>
        <!--End of AddBook  -->


    </div>
    <!--End of Button's field-->


</div>
<!--End of page container-->


<!--LogIn Modal window-->
<div class="modal" tabindex="-1" role="dialog" id="LoginModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <form class="well form-horizontal" action=""  id="contact_form">
                    <fieldset>
                        <!-- Form Name -->
                        <legend class="text-center">Enter the system</legend>
                        <div class="form-group">
                            <label class="col-md-2 control-label">Login</label>
                            <div class="col-md-8 inputGroupContainer">
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                    <input name="first_name" placeholder="Your login" id="login-username" class="form-control" type="text">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2 control-label">Password</label>
                            <div class="col-md-8 inputGroupContainer">
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                    <input name="password" type="password" id="login-password" placeholder="Your password"
                                           class="form-control" type="text">
                                </div>
                            </div>
                        </div>
                        <!-- Button -->
                        <div class="form-group">
                            <div class="col-md-12 text-center">
                                <button type="submit" class="btn btn-success" id="login-button">Login <span
                                        class="glyphicon glyphicon-ok"></span></button>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>

        </div>
    </div>
</div>
<!--End of LogIn window -->


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.3/js/bootstrapValidator.js"></script>
<script src="js/valid.js"></script>
<script src="js/add_book.js"></script>
<script src="js/author_autocomplete.js"></script>
</body>
<script>

    $(function() {

        if(localStorage.getItem("A-Token")!= null){
            $.ajax({
                "url": "http://localhost:8080/api/user",
                'method': 'GET',
                'contentType': 'application/json',
                'dataType': 'json',
                'headers': {
                    'A-Token': localStorage.getItem('A-Token'),
                    'Content-Type': 'application/json;charset=utf-8'
                },
                'success': function(response) {
                    $('.login-btn').hide();
                    $('#username').append(""+response.username+"")
                    $('#username').show();
                },
                'error': function(error) {
                    console.log(error);
                    localStorage.removeItem("A-Token");
                }
            });
        }else{
            $('#edit-book').hide();
        }
        $.ajax({
            'url': 'http://localhost:8080/api/authors',
            'type': "GET",
            'contentType': 'application/json',
            'dataType': 'json',
            'success': function(response) {

                for (i = 0;i<response.length;i++) {
                    $('#authors-select-list').append("<option>"+response[i].fullName+"</option>")
                }
            },
            'error': function(error) {
                console.log(error)
            }
        });

        $.ajax({
            'url': 'http://localhost:8080/api/books',
            'type': "GET",
            'contentType': 'application/json',
            'dataType': 'json',
            'success': function(response) {

                for (i = 0;i<response.length;i++) {
                    $('#books-table').append('<tr><th scope="row">'+(i+1)+'</th><td>'+response[i].bookName+'</td><td>'+response[i].genre+'</td><td>'+response[i].bookAuthor+'</td></tr>');
                }
                $('.badge').append(response.length);
            },
            'error': function(error) {
                console.log(error)
            }
        });
    });

    $('#login-button').click(function() {
        var username = $('#login-username').val();
        var password = $('#login-password').val();
        var loginRequest = {
            'username': username,
            'password': password
        };
        $.ajax({
            'url': 'http://localhost:8080/api/login',
            'type': "POST",
            'contentType': 'application/json',
            'dataType': 'json',
            'data': JSON.stringify(loginRequest),
            'success': function(data) {
                localStorage.setItem(data.key, data.value);
                document.location.reload();
                console.log(localStorage.getItem("A-Token"));
            },
            'error': function(error) {
                console.log(error);
            }
        });
    });

    $('#add-book-save-button').click(function() {
        var bookName = $('#add-book-name').val();
        var genre = $('#add-book-genre').val();
        var bookAuthor = $('#add-book-author-name').val();
        var newBook = {
            'bookName': bookName,
            'genre': genre,
            'bookAuthor': bookAuthor
        };
        $.ajax({
            'url': 'http://localhost:8080/api/private/books',
            'type': "POST",
            'contentType': 'application/json',
            'dataType': 'json',
            'data': JSON.stringify(newBook),
            'headers': {
                'A-Token': localStorage.getItem('A-Token'),
                'Content-Type': 'application/json;charset=utf-8'
            },
            'success': function(data) {
                document.location.reload();
            },
            'error': function(error) {
                console.log(error);
            }
        });
    });
</script>
</html>